<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employees - Freezy Bite Dashboard</title>
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Employee Page Specific Styles */
        .employee-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .employee-stat-card {
            background: var(--bg-card);
            padding: 1.25rem;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .employee-stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .employee-stat-card .icon.total { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .employee-stat-card .icon.active { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .employee-stat-card .icon.on-leave { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .employee-stat-card .icon.inactive { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        
        .employee-stat-card .info h4 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .employee-stat-card .info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Employee Cards Grid */
        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        
        .employee-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .employee-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }
        
        .employee-card-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }
        
        .employee-card-header.sales { background: linear-gradient(135deg, #10b981, #059669); }
        .employee-card-header.support { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .employee-card-header.inventory { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .employee-card-header.delivery { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        
        .employee-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.3);
            margin-bottom: 0.75rem;
            object-fit: cover;
        }
        
        .employee-card-header h3 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }
        
        .employee-card-header p {
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
        }
        
        .employee-status-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .employee-status-badge.active { background: rgba(16, 185, 129, 0.9); color: white; }
        .employee-status-badge.on-leave { background: rgba(245, 158, 11, 0.9); color: white; }
        .employee-status-badge.inactive { background: rgba(239, 68, 68, 0.9); color: white; }
        
        .employee-card-body {
            padding: 1.25rem;
        }
        
        .employee-info-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--bg-secondary);
        }
        
        .employee-info-row:last-child {
            border-bottom: none;
        }
        
        .employee-info-row i {
            width: 20px;
            color: var(--text-muted);
        }
        
        .employee-info-row span {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .employee-stats-mini {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--bg-secondary);
        }
        
        .employee-stat-mini {
            text-align: center;
        }
        
        .employee-stat-mini .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .employee-stat-mini .label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .employee-card-footer {
            padding: 1rem 1.25rem;
            background: var(--bg-secondary);
            display: flex;
            gap: 0.5rem;
        }
        
        .employee-card-footer .btn {
            flex: 1;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        /* Activity Log Styles */
        .activity-log {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--bg-secondary);
            transition: background 0.2s;
        }
        
        .activity-item:hover {
            background: var(--bg-secondary);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .activity-icon.order { background: var(--primary-light); color: var(--primary); }
        .activity-icon.message { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .activity-icon.inventory { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .activity-icon.customer { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .activity-icon.product { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-content p {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .activity-content .activity-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Employee Profile Modal */
        .employee-profile-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            padding: 2rem;
            text-align: center;
            color: white;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
        }
        
        .employee-profile-header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.3);
            margin-bottom: 1rem;
            object-fit: cover;
        }
        
        .employee-profile-header h2 {
            margin-bottom: 0.25rem;
        }
        
        .employee-profile-header p {
            opacity: 0.9;
        }
        
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .profile-stat {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--border-radius-md);
            text-align: center;
        }
        
        .profile-stat .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .profile-stat .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .profile-section {
            margin-bottom: 1.5rem;
        }
        
        .profile-section h4 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--bg-secondary);
        }
        
        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .profile-info-item {
            display: flex;
            flex-direction: column;
        }
        
        .profile-info-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }
        
        .profile-info-item .value {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .employee-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .employees-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-info-grid {
                grid-template-columns: 1fr;
            }
            
            .employee-stat-card {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }
            
            .employee-stat-card .icon {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="sidebar-logo">
                <div class="logo-icon">
                    <i class="fas fa-snowflake"></i>
                </div>
                <span>Freezy Bite</span>
            </a>
            <button class="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li>
                    <a href="index.html" class="nav-item">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Overview</span>
                    </a>
                </li>
                <li>
                    <a href="content.html" class="nav-item">
                        <i class="fas fa-palette"></i>
                        <span class="nav-text">Website Content</span>
                    </a>
                </li>
                <li>
                    <a href="offers.html" class="nav-item">
                        <i class="fas fa-tags"></i>
                        <span class="nav-text">Special Offers</span>
                    </a>
                </li>
                <li>
                    <a href="products.html" class="nav-item">
                        <i class="fas fa-box"></i>
                        <span class="nav-text">Products</span>
                    </a>
                </li>
                <li>
                    <a href="orders.html" class="nav-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="nav-text">Orders</span>
                    </a>
                </li>
                <li>
                    <a href="customers.html" class="nav-item">
                        <i class="fas fa-users"></i>
                        <span class="nav-text">Customers</span>
                    </a>
                </li>
                <li>
                    <a href="messages.html" class="nav-item">
                        <i class="fas fa-envelope"></i>
                        <span class="nav-text">Messages</span>
                    </a>
                </li>
                <li>
                    <a href="analytics.html" class="nav-item">
                        <i class="fas fa-chart-bar"></i>
                        <span class="nav-text">Analytics</span>
                    </a>
                </li>
                <li>
                    <a href="inventory.html" class="nav-item">
                        <i class="fas fa-warehouse"></i>
                        <span class="nav-text">Inventory</span>
                    </a>
                </li>
                <li>
                    <a href="employees.html" class="nav-item active">
                        <i class="fas fa-id-badge"></i>
                        <span class="nav-text">Employees</span>
                    </a>
                </li>
                <li>
                    <a href="users.html" class="nav-item">
                        <i class="fas fa-user-shield"></i>
                        <span class="nav-text">Users</span>
                    </a>
                </li>
                <li>
                    <a href="trash.html" class="nav-item">
                        <i class="fas fa-trash-alt"></i>
                        <span class="nav-text">Trash</span>
                    </a>
                </li>
                <li>
                    <a href="settings.html" class="nav-item">
                        <i class="fas fa-cog"></i>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-profile">
                <img src="https://ui-avatars.com/api/?name=Admin+User&background=6366f1&color=fff" alt="Admin" class="user-avatar">
                <div class="user-info">
                    <h4>Admin User</h4>
                    <p>admin@freezybite.com</p>
                </div>
            </div>
            <button class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Header -->
        <header class="top-header">
            <div class="header-left">
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search employees..." id="employeeSearchInput" oninput="searchEmployees(this.value)">
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="badge">5</span>
                </button>
                <button class="header-btn" onclick="showMessages()">
                    <i class="fas fa-envelope"></i>
                    <span class="badge">3</span>
                </button>
                <button class="header-btn" onclick="showTrashModal()" title="Trash">
                    <i class="fas fa-trash-alt"></i>
                    <span class="badge" id="headerTrashBadge">0</span>
                </button>
                <img src="https://ui-avatars.com/api/?name=Admin+User&background=6366f1&color=fff" alt="Admin" class="header-avatar">
            </div>
        </header>
        
        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Section Header -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h1 class="section-title"><i class="fas fa-id-badge" style="color: var(--primary); margin-right: 0.5rem;"></i>Employee Management</h1>
                        <p class="section-subtitle">Track employee activities, performance, and manage team members.</p>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-secondary" onclick="openActivityLogModal()">
                            <i class="fas fa-history"></i>
                            Activity Log
                        </button>
                        <button class="btn btn-primary" onclick="openAddEmployeeModal()">
                            <i class="fas fa-user-plus"></i>
                            Add Employee
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Employee Stats -->
            <div class="employee-stats">
                <div class="employee-stat-card">
                    <div class="icon total">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="info">
                        <h4 id="totalEmployeesCount">0</h4>
                        <p>Total Employees</p>
                    </div>
                </div>
                <div class="employee-stat-card">
                    <div class="icon active">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="info">
                        <h4 id="activeEmployeesCount">0</h4>
                        <p>Active</p>
                    </div>
                </div>
                <div class="employee-stat-card">
                    <div class="icon on-leave">
                        <i class="fas fa-user-clock"></i>
                    </div>
                    <div class="info">
                        <h4 id="onLeaveEmployeesCount">0</h4>
                        <p>On Leave</p>
                    </div>
                </div>
                <div class="employee-stat-card">
                    <div class="icon inactive">
                        <i class="fas fa-user-times"></i>
                    </div>
                    <div class="info">
                        <h4 id="inactiveEmployeesCount">0</h4>
                        <p>Inactive</p>
                    </div>
                </div>
            </div>
            
            <!-- Department Filter -->
            <div class="data-card" style="margin-bottom: 1.5rem; padding: 1rem;">
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-sm btn-primary" onclick="filterByDepartment('')" id="filterAll">All</button>
                    <button class="btn btn-sm btn-secondary" onclick="filterByDepartment('sales')" id="filterSales">
                        <i class="fas fa-shopping-cart"></i> Sales
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="filterByDepartment('support')" id="filterSupport">
                        <i class="fas fa-headset"></i> Support
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="filterByDepartment('inventory')" id="filterInventory">
                        <i class="fas fa-warehouse"></i> Inventory
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="filterByDepartment('delivery')" id="filterDelivery">
                        <i class="fas fa-truck"></i> Delivery
                    </button>
                </div>
            </div>
            
            <!-- Employees Grid -->
            <div class="employees-grid" id="employeesGrid">
                <!-- Employee cards will be rendered here -->
            </div>
        </div>
    </main>
    
    <!-- Add Employee Modal -->
    <div class="modal-overlay" id="addEmployeeModal">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user-plus" style="color: var(--primary); margin-right: 0.5rem;"></i>Add New Employee</h2>
                <button class="modal-close" onclick="closeModal('addEmployeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addEmployeeForm" onsubmit="addEmployee(event)">
                <div class="modal-body">
                    <!-- Avatar Upload -->
                    <div class="form-group" style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="position: relative; display: inline-block;">
                            <img src="https://ui-avatars.com/api/?name=New+Employee&background=6366f1&color=fff&size=128" alt="Avatar" id="newEmployeeAvatarPreview" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary-light); object-fit: cover;">
                            <button type="button" class="btn btn-sm btn-primary" onclick="document.getElementById('newEmployeeAvatarInput').click()" style="position: absolute; bottom: 0; right: 0; width: 28px; height: 28px; padding: 0; border-radius: 50%;">
                                <i class="fas fa-camera" style="font-size: 0.7rem;"></i>
                            </button>
                        </div>
                        <input type="file" id="newEmployeeAvatarInput" accept="image/*" style="display: none;" onchange="previewNewEmployeeAvatar(event)">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" class="form-input" id="newEmployeeName" placeholder="Enter full name" required oninput="updateNewEmployeeAvatarPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employee ID <span class="required">*</span></label>
                            <input type="text" class="form-input" id="newEmployeeId" placeholder="e.g., EMP-001" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email <span class="required">*</span></label>
                            <input type="email" class="form-input" id="newEmployeeEmail" placeholder="Enter email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="newEmployeePhone" placeholder="+20 1XX XXX XXXX" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Department <span class="required">*</span></label>
                            <select class="form-select" id="newEmployeeDepartment" required>
                                <option value="">Select Department</option>
                                <option value="sales">Sales</option>
                                <option value="support">Customer Support</option>
                                <option value="inventory">Inventory Management</option>
                                <option value="delivery">Delivery</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position <span class="required">*</span></label>
                            <input type="text" class="form-input" id="newEmployeePosition" placeholder="e.g., Sales Associate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Hire Date <span class="required">*</span></label>
                            <input type="date" class="form-input" id="newEmployeeHireDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Salary (EGP)</label>
                            <input type="number" class="form-input" id="newEmployeeSalary" placeholder="Monthly salary">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-input" id="newEmployeeAddress" placeholder="Enter address">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addEmployeeModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Add Employee
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Employee Modal -->
    <div class="modal-overlay" id="editEmployeeModal">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user-edit" style="color: var(--primary); margin-right: 0.5rem;"></i>Edit Employee</h2>
                <button class="modal-close" onclick="closeModal('editEmployeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editEmployeeForm" onsubmit="updateEmployee(event)">
                <input type="hidden" id="editEmployeeIndex">
                <div class="modal-body">
                    <!-- Avatar Upload -->
                    <div class="form-group" style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="position: relative; display: inline-block;">
                            <img src="" alt="Avatar" id="editEmployeeAvatarPreview" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary-light); object-fit: cover;">
                            <button type="button" class="btn btn-sm btn-primary" onclick="document.getElementById('editEmployeeAvatarInput').click()" style="position: absolute; bottom: 0; right: 0; width: 28px; height: 28px; padding: 0; border-radius: 50%;">
                                <i class="fas fa-camera" style="font-size: 0.7rem;"></i>
                            </button>
                        </div>
                        <input type="file" id="editEmployeeAvatarInput" accept="image/*" style="display: none;" onchange="previewEditEmployeeAvatar(event)">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" class="form-input" id="editEmployeeName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employee ID</label>
                            <input type="text" class="form-input" id="editEmployeeIdField" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email <span class="required">*</span></label>
                            <input type="email" class="form-input" id="editEmployeeEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="editEmployeePhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Department <span class="required">*</span></label>
                            <select class="form-select" id="editEmployeeDepartment" required>
                                <option value="sales">Sales</option>
                                <option value="support">Customer Support</option>
                                <option value="inventory">Inventory Management</option>
                                <option value="delivery">Delivery</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position <span class="required">*</span></label>
                            <input type="text" class="form-input" id="editEmployeePosition" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="editEmployeeStatus">
                                <option value="active">Active</option>
                                <option value="on-leave">On Leave</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Salary (EGP)</label>
                            <input type="number" class="form-input" id="editEmployeeSalary">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-input" id="editEmployeeAddress">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editEmployeeModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Employee Profile Modal -->
    <div class="modal-overlay" id="employeeProfileModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header" style="display: none;"></div>
            <div class="modal-body" id="employeeProfileContent" style="padding: 0;">
                <!-- Profile content will be rendered here -->
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--bg-secondary);">
                <button class="btn btn-secondary" onclick="closeModal('employeeProfileModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Activity Log Modal -->
    <div class="modal-overlay" id="activityLogModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-history" style="color: var(--primary); margin-right: 0.5rem;"></i>Activity Log</h2>
                <button class="modal-close" onclick="closeModal('activityLogModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="padding: 1rem; border-bottom: 1px solid var(--bg-secondary);">
                    <select class="form-select" id="activityFilterEmployee" onchange="filterActivityLog()" style="width: 100%;">
                        <option value="">All Employees</option>
                    </select>
                </div>
                <div class="activity-log" id="activityLogContent">
                    <!-- Activity items will be rendered here -->
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/dashboard.js"></script>
    <script>
        // Use global employees data from dashboard.js (synced via localStorage)
        // This ensures consistency across all pages
        let employees = window.globalEmployees || [];
        let activityLog = window.globalActivityLog || [];
        
        // Temporary avatar storage
        let newEmployeeAvatarData = null;
        let editEmployeeAvatarData = null;
        let currentDepartmentFilter = '';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            renderEmployeesGrid();
            updateEmployeeStats();
        });
        
        // Render employees grid
        function renderEmployeesGrid(filter = '', search = '') {
            const container = document.getElementById('employeesGrid');
            if (!container) return;
            
            let filteredEmployees = employees;
            
            if (filter) {
                filteredEmployees = filteredEmployees.filter(e => e.department === filter);
            }
            
            if (search) {
                const term = search.toLowerCase();
                filteredEmployees = filteredEmployees.filter(e => 
                    e.name.toLowerCase().includes(term) ||
                    e.id.toLowerCase().includes(term) ||
                    e.email.toLowerCase().includes(term) ||
                    e.position.toLowerCase().includes(term)
                );
            }
            
            if (filteredEmployees.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-muted);">
                        <i class="fas fa-users" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <h3 style="color: var(--text-secondary);">No employees found</h3>
                        <p>Try adjusting your search or filter</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredEmployees.map((emp, index) => {
                const defaultAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(emp.name)}&background=${getDepartmentColor(emp.department)}&color=fff&size=160`;
                const avatar = emp.avatar || defaultAvatar;
                const totalActions = emp.stats.orders + emp.stats.messages + emp.stats.inventory;
                
                return `
                    <div class="employee-card">
                        <div class="employee-card-header ${emp.department}">
                            <span class="employee-status-badge ${emp.status}">${formatStatus(emp.status)}</span>
                            <img src="${avatar}" alt="${emp.name}" class="employee-avatar">
                            <h3>${emp.name}</h3>
                            <p>${emp.position}</p>
                        </div>
                        <div class="employee-card-body">
                            <div class="employee-info-row">
                                <i class="fas fa-id-badge"></i>
                                <span>${emp.id}</span>
                            </div>
                            <div class="employee-info-row">
                                <i class="fas fa-envelope"></i>
                                <span>${emp.email}</span>
                            </div>
                            <div class="employee-info-row">
                                <i class="fas fa-phone"></i>
                                <span>${emp.phone}</span>
                            </div>
                            <div class="employee-info-row">
                                <i class="fas fa-building"></i>
                                <span>${formatDepartment(emp.department)}</span>
                            </div>
                            <div class="employee-stats-mini">
                                <div class="employee-stat-mini">
                                    <div class="value">${emp.stats.orders}</div>
                                    <div class="label">Orders</div>
                                </div>
                                <div class="employee-stat-mini">
                                    <div class="value">${emp.stats.messages}</div>
                                    <div class="label">Messages</div>
                                </div>
                                <div class="employee-stat-mini">
                                    <div class="value">${emp.stats.inventory}</div>
                                    <div class="label">Inventory</div>
                                </div>
                            </div>
                        </div>
                        <div class="employee-card-footer">
                            <button class="btn btn-sm btn-primary" onclick="viewEmployeeProfile(${index})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="editEmployee(${index})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Update employee stats
        function updateEmployeeStats() {
            const total = employees.length;
            const active = employees.filter(e => e.status === 'active').length;
            const onLeave = employees.filter(e => e.status === 'on-leave').length;
            const inactive = employees.filter(e => e.status === 'inactive').length;
            
            document.getElementById('totalEmployeesCount').textContent = total;
            document.getElementById('activeEmployeesCount').textContent = active;
            document.getElementById('onLeaveEmployeesCount').textContent = onLeave;
            document.getElementById('inactiveEmployeesCount').textContent = inactive;
        }
        
        // Helper functions
        function getDepartmentColor(dept) {
            const colors = {
                'sales': '10b981',
                'support': '3b82f6',
                'inventory': 'f59e0b',
                'delivery': '8b5cf6'
            };
            return colors[dept] || '6366f1';
        }
        
        function formatDepartment(dept) {
            const names = {
                'sales': 'Sales',
                'support': 'Customer Support',
                'inventory': 'Inventory Management',
                'delivery': 'Delivery'
            };
            return names[dept] || dept;
        }
        
        function formatStatus(status) {
            const names = {
                'active': 'Active',
                'on-leave': 'On Leave',
                'inactive': 'Inactive'
            };
            return names[status] || status;
        }
        
        // Filter by department
        function filterByDepartment(dept) {
            currentDepartmentFilter = dept;
            
            // Update button states
            document.querySelectorAll('[id^="filter"]').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            
            const activeBtn = dept ? document.getElementById(`filter${dept.charAt(0).toUpperCase() + dept.slice(1)}`) : document.getElementById('filterAll');
            if (activeBtn) {
                activeBtn.classList.remove('btn-secondary');
                activeBtn.classList.add('btn-primary');
            }
            
            renderEmployeesGrid(dept, document.getElementById('employeeSearchInput')?.value || '');
        }
        
        // Search employees
        function searchEmployees(term) {
            renderEmployeesGrid(currentDepartmentFilter, term);
        }
        
        // View employee profile
        function viewEmployeeProfile(index) {
            const emp = employees[index];
            if (!emp) return;
            
            const defaultAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(emp.name)}&background=${getDepartmentColor(emp.department)}&color=fff&size=200`;
            const avatar = emp.avatar || defaultAvatar;
            const totalActions = emp.stats.orders + emp.stats.messages + emp.stats.inventory;
            
            // Get employee activities
            const empActivities = activityLog.filter(a => a.employeeId === emp.id).slice(0, 5);
            
            const content = `
                <div class="employee-profile-header" style="background: linear-gradient(135deg, ${getGradientColors(emp.department)});">
                    <button class="modal-close" onclick="closeModal('employeeProfileModal')" style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                    <img src="${avatar}" alt="${emp.name}">
                    <h2>${emp.name}</h2>
                    <p>${emp.position} â€¢ ${formatDepartment(emp.department)}</p>
                    <span class="employee-status-badge ${emp.status}" style="margin-top: 0.5rem;">${formatStatus(emp.status)}</span>
                </div>
                <div style="padding: 1.5rem;">
                    <div class="profile-stats-grid">
                        <div class="profile-stat">
                            <div class="value">${emp.stats.orders}</div>
                            <div class="label">Orders Handled</div>
                        </div>
                        <div class="profile-stat">
                            <div class="value">${emp.stats.messages}</div>
                            <div class="label">Messages Answered</div>
                        </div>
                        <div class="profile-stat">
                            <div class="value">${emp.stats.inventory}</div>
                            <div class="label">Inventory Updates</div>
                        </div>
                        <div class="profile-stat">
                            <div class="value">${totalActions}</div>
                            <div class="label">Total Actions</div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <h4><i class="fas fa-user"></i> Personal Information</h4>
                        <div class="profile-info-grid">
                            <div class="profile-info-item">
                                <span class="label">Employee ID</span>
                                <span class="value">${emp.id}</span>
                            </div>
                            <div class="profile-info-item">
                                <span class="label">Email</span>
                                <span class="value">${emp.email}</span>
                            </div>
                            <div class="profile-info-item">
                                <span class="label">Phone</span>
                                <span class="value">${emp.phone}</span>
                            </div>
                            <div class="profile-info-item">
                                <span class="label">Address</span>
                                <span class="value">${emp.address || 'Not specified'}</span>
                            </div>
                            <div class="profile-info-item">
                                <span class="label">Hire Date</span>
                                <span class="value">${emp.hireDate}</span>
                            </div>
                            <div class="profile-info-item">
                                <span class="label">Salary</span>
                                <span class="value">${emp.salary ? `EGP ${emp.salary.toLocaleString()}` : 'Not specified'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <h4><i class="fas fa-history"></i> Recent Activity</h4>
                        ${empActivities.length > 0 ? `
                            <div class="activity-log" style="max-height: 250px; border: 1px solid var(--bg-secondary); border-radius: var(--border-radius-md);">
                                ${empActivities.map(activity => `
                                    <div class="activity-item">
                                        <div class="activity-icon ${activity.type}">
                                            <i class="fas fa-${getActivityIcon(activity.type)}"></i>
                                        </div>
                                        <div class="activity-content">
                                            <p>${activity.action}</p>
                                            <span class="activity-time">${activity.timestamp}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <p style="color: var(--text-muted); text-align: center; padding: 2rem;">No recent activity</p>
                        `}
                    </div>
                </div>
            `;
            
            document.getElementById('employeeProfileContent').innerHTML = content;
            openModal('employeeProfileModal');
        }
        
        function getGradientColors(dept) {
            const gradients = {
                'sales': '#10b981, #059669',
                'support': '#3b82f6, #2563eb',
                'inventory': '#f59e0b, #d97706',
                'delivery': '#8b5cf6, #7c3aed'
            };
            return gradients[dept] || '#6366f1, #4f46e5';
        }
        
        function getActivityIcon(type) {
            const icons = {
                'order': 'shopping-cart',
                'message': 'envelope',
                'inventory': 'warehouse',
                'customer': 'user-plus',
                'product': 'box'
            };
            return icons[type] || 'check';
        }
        
        // Open add employee modal
        function openAddEmployeeModal() {
            document.getElementById('addEmployeeForm').reset();
            newEmployeeAvatarData = null;
            document.getElementById('newEmployeeAvatarPreview').src = 'https://ui-avatars.com/api/?name=New+Employee&background=6366f1&color=fff&size=128';
            
            // Set default hire date to today
            document.getElementById('newEmployeeHireDate').value = new Date().toISOString().split('T')[0];
            
            // Generate next employee ID
            const lastId = employees.length > 0 ? parseInt(employees[employees.length - 1].id.split('-')[1]) : 0;
            document.getElementById('newEmployeeId').value = `EMP-${String(lastId + 1).padStart(3, '0')}`;
            
            openModal('addEmployeeModal');
        }
        
        // Preview new employee avatar
        function previewNewEmployeeAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newEmployeeAvatarData = e.target.result;
                    document.getElementById('newEmployeeAvatarPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Update avatar preview based on name
        function updateNewEmployeeAvatarPreview() {
            if (newEmployeeAvatarData) return;
            const name = document.getElementById('newEmployeeName').value || 'New Employee';
            document.getElementById('newEmployeeAvatarPreview').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=6366f1&color=fff&size=128`;
        }
        
        // Add employee
        function addEmployee(event) {
            event.preventDefault();
            
            const newEmployee = {
                id: document.getElementById('newEmployeeId').value,
                name: document.getElementById('newEmployeeName').value,
                email: document.getElementById('newEmployeeEmail').value,
                phone: document.getElementById('newEmployeePhone').value,
                department: document.getElementById('newEmployeeDepartment').value,
                position: document.getElementById('newEmployeePosition').value,
                status: 'active',
                hireDate: document.getElementById('newEmployeeHireDate').value,
                salary: parseInt(document.getElementById('newEmployeeSalary').value) || 0,
                address: document.getElementById('newEmployeeAddress').value,
                avatar: newEmployeeAvatarData,
                stats: { orders: 0, messages: 0, inventory: 0 }
            };
            
            // Check for duplicate ID
            if (employees.some(e => e.id === newEmployee.id)) {
                showAlert('error', 'Employee ID already exists!');
                return;
            }
            
            employees.push(newEmployee);
            newEmployeeAvatarData = null;
            
            // Log the activity
            logActivity(newEmployee.id, newEmployee.name, 'customer', `New employee ${newEmployee.name} was added to the system`);
            
            // Sync to localStorage
            syncEmployeeData();
            
            closeModal('addEmployeeModal');
            renderEmployeesGrid(currentDepartmentFilter);
            updateEmployeeStats();
            
            showAlert('success', `Employee "${newEmployee.name}" added successfully!`);
        }
        
        // Edit employee
        function editEmployee(index) {
            const emp = employees[index];
            if (!emp) return;
            
            editEmployeeAvatarData = null;
            
            document.getElementById('editEmployeeIndex').value = index;
            document.getElementById('editEmployeeName').value = emp.name;
            document.getElementById('editEmployeeIdField').value = emp.id;
            document.getElementById('editEmployeeEmail').value = emp.email;
            document.getElementById('editEmployeePhone').value = emp.phone;
            document.getElementById('editEmployeeDepartment').value = emp.department;
            document.getElementById('editEmployeePosition').value = emp.position;
            document.getElementById('editEmployeeStatus').value = emp.status;
            document.getElementById('editEmployeeSalary').value = emp.salary || '';
            document.getElementById('editEmployeeAddress').value = emp.address || '';
            
            const defaultAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(emp.name)}&background=${getDepartmentColor(emp.department)}&color=fff&size=128`;
            document.getElementById('editEmployeeAvatarPreview').src = emp.avatar || defaultAvatar;
            
            openModal('editEmployeeModal');
        }
        
        // Preview edit employee avatar
        function previewEditEmployeeAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editEmployeeAvatarData = e.target.result;
                    document.getElementById('editEmployeeAvatarPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Update employee
        function updateEmployee(event) {
            event.preventDefault();
            
            const index = parseInt(document.getElementById('editEmployeeIndex').value);
            const emp = employees[index];
            if (!emp) return;
            
            emp.name = document.getElementById('editEmployeeName').value;
            emp.email = document.getElementById('editEmployeeEmail').value;
            emp.phone = document.getElementById('editEmployeePhone').value;
            emp.department = document.getElementById('editEmployeeDepartment').value;
            emp.position = document.getElementById('editEmployeePosition').value;
            emp.status = document.getElementById('editEmployeeStatus').value;
            emp.salary = parseInt(document.getElementById('editEmployeeSalary').value) || 0;
            emp.address = document.getElementById('editEmployeeAddress').value;
            
            if (editEmployeeAvatarData) {
                emp.avatar = editEmployeeAvatarData;
            }
            
            editEmployeeAvatarData = null;
            
            // Sync to localStorage
            syncEmployeeData();
            
            closeModal('editEmployeeModal');
            renderEmployeesGrid(currentDepartmentFilter);
            updateEmployeeStats();
            
            showAlert('success', `Employee "${emp.name}" updated successfully!`);
        }
        
        // Delete employee
        function deleteEmployee(index) {
            const emp = employees[index];
            if (!emp) return;
            
            if (!confirm(`Are you sure you want to delete "${emp.name}"? This action cannot be undone.`)) {
                return;
            }
            
            employees.splice(index, 1);
            
            // Sync to localStorage
            syncEmployeeData();
            
            renderEmployeesGrid(currentDepartmentFilter);
            updateEmployeeStats();
            
            showAlert('success', `Employee "${emp.name}" deleted successfully!`);
        }
        
        // Sync employee data to localStorage
        function syncEmployeeData() {
            window.globalEmployees = employees;
            window.globalActivityLog = activityLog;
            localStorage.setItem('freezyBiteEmployees', JSON.stringify(employees));
            localStorage.setItem('freezyBiteActivityLog', JSON.stringify(activityLog));
        }
        
        // Open activity log modal
        function openActivityLogModal() {
            // Populate employee filter
            const filterSelect = document.getElementById('activityFilterEmployee');
            filterSelect.innerHTML = '<option value="">All Employees</option>' +
                employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
            
            renderActivityLog();
            openModal('activityLogModal');
        }
        
        // Render activity log
        function renderActivityLog(employeeId = '') {
            const container = document.getElementById('activityLogContent');
            
            let filteredActivities = activityLog;
            if (employeeId) {
                filteredActivities = activityLog.filter(a => a.employeeId === employeeId);
            }
            
            if (filteredActivities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                        <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <p>No activities found</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredActivities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${activity.type}">
                        <i class="fas fa-${getActivityIcon(activity.type)}"></i>
                    </div>
                    <div class="activity-content">
                        <p><strong>${activity.employeeName}</strong> ${activity.action}</p>
                        <span class="activity-time">${activity.timestamp}</span>
                    </div>
                </div>
            `).join('');
        }
        
        // Filter activity log
        function filterActivityLog() {
            const employeeId = document.getElementById('activityFilterEmployee').value;
            renderActivityLog(employeeId);
        }
        
        // Log activity (can be called from other pages)
        function logActivity(employeeId, employeeName, type, action) {
            const newActivity = {
                id: Date.now(),
                employeeId: employeeId,
                employeeName: employeeName,
                type: type,
                action: action,
                timestamp: new Date().toLocaleString()
            };
            
            activityLog.unshift(newActivity);
            
            // Update employee stats
            const emp = employees.find(e => e.id === employeeId);
            if (emp) {
                if (type === 'order') emp.stats.orders++;
                if (type === 'message') emp.stats.messages++;
                if (type === 'inventory') emp.stats.inventory++;
            }
            
            // Sync to localStorage
            syncEmployeeData();
        }
        
        // Make functions globally available
        window.logActivity = logActivity;
        window.employees = employees;
        window.activityLog = activityLog;
        window.syncEmployeeData = syncEmployeeData;
    </script>
</body>
</html>

